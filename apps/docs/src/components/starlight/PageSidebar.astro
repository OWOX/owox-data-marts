---
import type { Props } from '@astrojs/starlight/props';
import Default from '@astrojs/starlight/components/PageSidebar.astro';
---

<button id="sidebar-toggle" class="sidebar-toggle-btn" aria-label="Toggle sidebar" title="Toggle sidebar">
    <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
      <path d="M7 14l5-5-5-5v10z"/>
    </svg>
  </button>

<div id="page-sidebar" class="custom-page-sidebar">
  <Default {...Astro.props} />
</div>

<style is:global>
  .sidebar-toggle-btn {
    position: fixed;
    right: 0;
    top: 50%;
    transform: translateY(-50%);
    z-index: 100;
    background: var(--sl-color-bg-nav);
    border: 1px solid var(--sl-color-hairline);
    border-right: none;
    border-radius: 0.5rem 0 0 0.5rem;
    padding: 0.75rem 0.5rem;
    cursor: pointer;
    transition: all 0.3s ease;
    color: var(--sl-color-text);
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .sidebar-toggle-btn:hover {
    background: var(--sl-color-bg-sidebar);
    border-color: var(--sl-color-text-accent);
  }

  .sidebar-toggle-btn svg {
    transition: transform 0.3s ease;
  }

  .sidebar-toggle-btn.collapsed svg {
    transform: rotate(180deg);
  }

  .custom-page-sidebar {
    transition: transform 0.3s ease, opacity 0.3s ease;
  }

  .custom-page-sidebar.collapsed {
    transform: translateX(100%);
    opacity: 0;
    pointer-events: none;
  }

  .right-sidebar-container {
    transition: width 0.3s ease, opacity 0.3s ease;
  }

  .right-sidebar-container.collapsed {
    width: 0 !important;
    overflow: hidden;
  }

  .main-pane.sidebar-collapsed {
    --sl-sidebar-width: 0rem !important;
  }

  /* Hide toggle on mobile */
  @media (max-width: 72rem) {
    .sidebar-toggle-btn {
      display: none;
    }
  }
</style>

<script>
  function initSidebarToggle() {
    const toggleBtn = document.getElementById('sidebar-toggle');
    const sidebar = document.getElementById('page-sidebar');
    const container = document.querySelector('.right-sidebar-container');
    const mainPane = document.querySelector('.main-pane');
    
    if (!toggleBtn || !sidebar || !container || !mainPane) return;

    // Load saved state
    const isCollapsed = localStorage.getItem('sidebar-collapsed') === 'true';
    if (isCollapsed) {
      toggleBtn.classList.add('collapsed');
      sidebar.classList.add('collapsed');
      container.classList.add('collapsed');
      mainPane.classList.add('sidebar-collapsed');
    }

    toggleBtn.addEventListener('click', () => {
      const collapsed = toggleBtn.classList.toggle('collapsed');
      sidebar.classList.toggle('collapsed');
      container.classList.toggle('collapsed');
      mainPane.classList.toggle('sidebar-collapsed');
      
      // Save state
      localStorage.setItem('sidebar-collapsed', String(collapsed));
    });
  }

  // Initialize on page load
  document.addEventListener('DOMContentLoaded', initSidebarToggle);
  
  // Re-initialize on Astro page transitions
  document.addEventListener('astro:page-load', initSidebarToggle);
</script>
